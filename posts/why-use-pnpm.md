---
title: 'pnpmã¯ãªã«ãŒé•ã†ã®ã‹'
preface: 'yarnã‹ã‚‰pnpmã«ç§»è¡Œã—ãŸã®ã§ã¾ã¨ã‚ã¦ã¿ã‚‹'
createdAt: '2023-03-11'
eyecatch: '/blog/monorepo-reactnative-forweb/duck_3d.png'
category: 'tech'
tags: ['pnpm']
isDraft: true
---

## pnpm ã§ã®ç®¡ç†

npm ã‚„ yarn ã®ã‚ˆã†ãª node_modules ç›´ä¸‹ã§ãƒ•ãƒ©ãƒƒãƒˆã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ãã®ä¾å­˜ã‚’å…¨ã¦ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚
ä¸€æ–¹ã§ã€pnpm ã¯ ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’åˆ©ç”¨ã—ã¦ node_modules ã«é…ç½®ã—ã¦ã€ **.pnpm** ã®ä¸­ã«ä»¥ä¸‹ã®å‘½åè¦å‰‡ã§é…ç½®ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ•ãƒ©ãƒƒãƒˆã«ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚

```txt
// ã“ã‚Œã‚’ä»®æƒ³ã‚¹ãƒˆã‚¢ã¨å‘¼ã¶
.pnpm/<name>@<version>/node_modules/<name>
```

> ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¨ã¯
> ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ¥åã‚’æŒãŸã›ã‚‹ç‰¹æ®Šãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¨ãƒ³ãƒˆãƒªã§ã‚ã‚‹ã€‚ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¯ãã®å†…éƒ¨ã«ã²ã¨ã¤ã®ãƒ‘ã‚¹åã‚’è¨˜æ†¶ã—ã¦ã„ã‚‹ã€‚é€šå¸¸ã®å…¥å‡ºåŠ› API ã‚’ç”¨ã„ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€å®Ÿéš›ã«ã¯ãã“ã«è¨˜æ†¶ã•ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¹åãŒè¡¨ã™å¯¾è±¡ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè¡Œã‚ã‚Œã‚‹ã€‚
> [å‡ºå…¸]IPA ISEC ã€€ã‚»ã‚­ãƒ¥ã‚¢ãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¬›åº§ï¼šC/C++è¨€èªç·¨ã€€ç¬¬ 9 ç«  ãƒ•ã‚¡ã‚¤ãƒ«å¯¾ç­–ï¼šã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ”»æ’ƒå¯¾ç­–

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ pnpm ã¯ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›´æ¥ã®ä¾å­˜é–¢ä¿‚ã®ã¿ã‚’ node_modules ç›´ä¸‹ã«è¿½åŠ ã—ã¾ã™ã€‚
ä¾å­˜é–¢ä¿‚ã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ¢ç´¢å¯èƒ½ãªã‚¹ãƒˆã‚¢ **.pnpm store** ã«æ ¼ç´ã•ã‚Œã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ node_modules ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã¿ã¨ãªã‚Šã¾ã™ã€‚

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ¢ç´¢å¯èƒ½ãªã‚¹ãƒˆã‚¢ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ãƒˆã‚¢ï¼‰ã¨ã¯ **.pnpm store** ã§ã‚ã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ãƒˆã‚¢ã® 1 ãƒ¶æ‰€ã‹ã‚‰ãƒãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã•ã‚Œã‚‹ãŸã‚ã€è¿½åŠ ã®ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚’æ¶ˆè²»ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
1 ãƒ¶æ‰€ã‹ã‚‰ãƒãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã§ãã‚‹ã“ã¨ã«ã‚ˆã‚Šç•°ãªã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰ã®åŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¾å­˜ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

### pnpm ã®å³æ ¼ã•

npm ã‚„ yarn ã¨æ¯”ã¹ã‚‹ã¨ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å¯¾ã™ã‚‹å³æ ¼ã•ã¯ã‹ãªã‚Šé«˜ãã†ã§ã™ã€‚pnpm ã®ã“ã®å³æ ¼ã•ã«é–¢ã—ã¦ã€[ã“ã¡ã‚‰ã®è¨˜äº‹](https://medium.com/pnpm/pnpms-strictness-helps-to-avoid-silly-bugs-9a15fb306308)ã§èª­ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®è¨˜äº‹ã‹ã‚‰ã€ã‚ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸçµæœã€ãã®ä¾å­˜é–¢ä¿‚ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã•ã‚‰ã«ã¯ä½¿ç”¨å¯èƒ½ã«ãªã‚‹ã“ã¨ã®ãƒªã‚¹ã‚¯ãŒã‚ˆãã‚ã‹ã‚Šã¾ã™ã€‚
ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ A ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸéš›ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ B ã«ä¾å­˜ã—ã¦ã„ã‚‹ã¨ã—ã¾ã™ã€‚ãã®å ´åˆã€`node_modules` ç›´ä¸‹ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ B ãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
ãã®æ™‚ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ããŸã¨ã—ã¦ã‚‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ A ãŒä½•ã‹ã—ã‚‰ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ B ã®ä¾å­˜ã‚’å‰Šé™¤ã™ã‚‹ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå£Šã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ã¾ãŸã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ B ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸ŠãŒã£ãŸå¾Œã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ A ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹å ´åˆã§ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå£Šã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ B ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆä»¥å‰ã«ãŠã‘ã‚‹ã‚‚ã®ã ã‹ã‚‰ã§ã™ã€‚

ã“ã®ã‚ˆã†ã«ãªã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ pnpm ã®å³æ ¼ã•ã¯ã¨ã¦ã‚‚ç´ æ™´ã‚‰ã—ã„ã‚‚ã®ã§ã‚ç†ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã¿ã—ã‹ä½¿ç”¨ã§ããªã„ã§ããªã„ã€ã¨ã„ã†ã‚‚ã®ã¯ã‚ã‚‹ã¹ãå§¿ã§ã‚ã‚‹ã¨ã‚‚æ€ãˆã¾ã™ã€‚ä»Šã¾ã§ç–‘å•ã«æ€ã‚ãªã‹ã£ãŸã®ãŒä¸æ€è­°ãªãã‚‰ã„ã§ã™ã€‚

### .pnpm ã‚’ã®ãã

pnpm ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¾‹ã‚’å‚è€ƒã«è¦‹ã¦ã¿ã¾ã™ã€‚ã¨ã¦ã‚‚ç°¡æ½”ãªä¾‹ã¨ãªã‚Šã¾ã™ãŒã€ä¾å­˜é–¢ä¿‚ãŒå¢—ãˆã¦ã‚°ãƒ©ãƒ•æ§‹é€ ãŒæ·±ããªã£ã¦ã‚‚åŸºæœ¬çš„ã«åŒã˜æ§‹é€ ã«ãªã‚Šã¾ã™ã€‚

```txt
node_modules
â”œâ”€â”€ foo -> ./.pnpm/foo@1.0.0/node_modules/foo // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®ä¾å­˜ => ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸Šã§æ˜ç¤ºçš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®
â””â”€â”€ .pnpm
    â”œâ”€â”€ bar@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ bar -> <store>/bar // è‡ªèº«ã¸ã®ãƒãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ => ã“ã‚ŒãŒå®Ÿä½“ã®ãƒ•ã‚¡ã‚¤ãƒ«
    â”‚       â””â”€â”€ qar -> ../../qar@2.0.0/node_modules/qar // ä¾å­˜ã—ã¦ã„ã‚‹qarã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
    â””â”€â”€ foo@1.0.0
        â””â”€â”€ node_modules
            â””â”€â”€ foo -> <store>/foo // è‡ªèº«ã¸ã®ãƒãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ => ã“ã‚ŒãŒå®Ÿä½“ã®ãƒ•ã‚¡ã‚¤ãƒ«
                â”œâ”€â”€ index.js
                â””â”€â”€ package.json
    â”‚       â”œâ”€â”€ bar -> ../../bar@1.0.0/node_modules/bar // ä¾å­˜ã—ã¦ã„ã‚‹barã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
    â”‚       â””â”€â”€ qar -> ../../qar@2.0.0/node_modules/qar // ä¾å­˜ã—ã¦ã„ã‚‹qarã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
    â””â”€â”€ qar@2.0.0
        â””â”€â”€ node_modules
            â””â”€â”€ qar -> <store>/qarã€€// è‡ªèº«ã¸ã®ãƒãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ => ã“ã‚ŒãŒå®Ÿä½“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

`foo@1.0.0/node_modules/foo/index.js` ãŒ`bar` ã‚’ è§£æ±ºã—ãŸã„ã¨ãã¯å®Ÿä½“ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–¹ã® `bar@1.0.0/node_modules/bar` ã‚’è¦‹ã¦è§£æ±ºã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ç®¡ç†ã•ã‚Œã‚‹ã“ã¨ã§ã€ä¾å­˜é–¢ä¿‚ã«å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã®ã¿ã«åˆ¶å¾¡ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ä»®ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ä¾å­˜é–¢ä¿‚ãŒå¢—ãˆã¦ã‚‚ã‚°ãƒ©ãƒ•ãŒæ·±ããªã‚‹ã ã‘ã§ã‚ã‚‹ãŸã‚ã€ã‚¹ãƒƒã¨é ­ã«å…¥ã‚‹æ§‹é€ ã§ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚

æœ€å¾Œã« next ã® **.pnpm** ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

```txt
â””â”€â”€ .pnpm
    â””â”€â”€ next@13.2.3_6m24vuloj5ihw4zc5lbsktc4fu
        â””â”€â”€ node_modules
           â””â”€â”€ @next // @next/xxxã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
                â”œâ”€â”€ env // @next/env
                â””â”€â”€ swc-darwin-x64 // @nextswc-darwin-x64
           â””â”€â”€ @swc // @swc/xxxã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
                â””â”€â”€ helpers // // @swc/helpers
           â”œâ”€â”€ caniuse-lite // caniuse-liteã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
           â”œâ”€â”€ next // è‡ªèº«ã¸ã®ãƒãƒ¼ãƒ‰ãƒªãƒ³ã‚¯
           â”œâ”€â”€ postcss  // postcssã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
           â”œâ”€â”€ react  // reactã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
           â”œâ”€â”€ react-dom  // react-domã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
           â””â”€â”€ styled-jsx // styled-jsxã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
```

ã•ã‚‰ã« next è‡ªä½“ã® package.json ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

```txt
"dependencies": {
    "@next/env": "13.2.3",
    "@swc/helpers": "0.4.14",
    "caniuse-lite": "^1.0.30001406",
    "postcss": "8.4.14",
    "styled-jsx": "5.1.1"
  },
  "peerDependencies": {
    "@opentelemetry/api": "^1.4.0",
    "fibers": ">= 3.1.0",
    "node-sass": "^6.0.0 || ^7.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "sass": "^1.3.0"
  },
  "peerDependenciesMeta": {
    "node-sass": {
      "optional": true
    },
    "sass": {
      "optional": true
    },
    "fibers": {
      "optional": true
    },
    "@opentelemetry/api": {
      "optional": true
    }
  },
```

2 ã¤ã‚’æ¯”ã¹ã¦ã¿ã‚‹ã¨ dependencies ã¨ optional ã§ãªã„ peerDependencies(react ã¨ react-dom)ã‚’ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¨ã—ã¦å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚

### ãŠã‚ã‚Šã«

pnpm ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å¤§éƒ¨åˆ†ãŒæ—¥æœ¬èªã§ç¿»è¨³ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€pnpm ã®ã‚³ãƒãƒ³ãƒ‰è‡ªä½“ã‚‚ npm ã‚„ yarn ã§ä½¿ç”¨ã—ã¦ã„ãŸã‚‚ã®ã¨ä¼¼é€šã£ãŸã‚‚ã®ãŒã»ã¨ã‚“ã©ã®ãŸã‚ã€ã™ãã«é›°å›²æ°—ã‚’æ´ã‚€ã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚
ã‚³ãƒãƒ³ãƒ‰ã§å›°ã£ãŸã‚Šé–“é•ã£ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã‚’æŒ‡å®šã—ã¦ã—ã¾ã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¤šã„å ´åˆã®ãŸã‚ã®ä¸‹è¨˜ã®ã‚ˆã†ãªç´ æ™´ã‚‰ã—ã„ãƒ„ãƒ¼ãƒ«ã‚‚ã‚ã‚Šã¾ã™ã€‚

[antfu/ni: ğŸ’¡ Use the right package manager](https://github.com/antfu/ni)

æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ ğŸ‘

### å‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆ

- [Fast, disk space efficient package manager | pnpm](https://pnpm.io/ja/)
- [pnpmâ€™s strictness helps to avoid silly bugs](https://medium.com/pnpm/pnpms-strictness-helps-to-avoid-silly-bugs-9a15fb306308)
